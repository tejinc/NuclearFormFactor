#include "TMath.h"
#include <iostream>

#include "Math/Minimizer.h"
#include "Math/Factory.h"
#include "Math/Functor.h"
#include "TRandom2.h"
#include "TError.h"
#include <iostream>

double lambda = 0.01;

double chiSqFunc( double v, double *par )
{
  double lambda = v;
  double a1 = par[0];
  double a2 = par[1];
  double a3 = par[2];
  double a4 = par[3];

  return (0. + 821.5128077848486*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      514.6899702360622*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) - 
      366.2392816804628*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) + 
      152.5496897804764*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
      103.90516288710376*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      85.4641333460586*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      14.163769295743728*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      24.998879569201303*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) - 
      12.31603044411953*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      4.843523877884223*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      2.134332035124435*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      35.70888272867219*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) - 
      19.106456404530434*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) - 
      8.966828390538852*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) + 
   (0. - 514.6899702360622*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) + 
      854.6715753439188*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
      118.81281023507468*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      366.4872618609842*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) - 
      35.646563133305726*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) + 
      127.50402464328127*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      3.000356140779082*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) - 
      46.34166750215187*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      26.825804209114352*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      6.359043933033931*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      6.331475439246687*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      43.088947670980176*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) - 
      45.80948004110472*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) - 
      7.6832951492841355*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
   (0. - 366.2392816804629*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) + 
      118.81281023507465*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
      445.75476953271766*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      56.51921354293852*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) - 
      198.68948040176224*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) + 
      29.86677921929518*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) + 
      41.63864760540112*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) - 
      17.124658248563755*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) - 
      18.19580979101099*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) - 
      11.596016650575804*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      0.31634102949785997*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) + 
      55.95003453917647*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
      14.355906198671974*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
      7.464611197384717*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) + 
   (0. + 152.54968978047637*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      366.48726186098406*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) - 
      56.519213542938516*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) + 
      622.6139864490967*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) - 
      6.870145626360223*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      430.26634043965487*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      5.010041297149725*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      203.33442385416183*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) - 
      124.08072290696454*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) - 
      7.282343104091491*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) + 
      2.4936710831199997*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) + 
      12.33502900056106*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) - 
      4.664752206833402*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
      3.18824158614613*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
   (0. + 103.90516288710374*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      35.646563133305676*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) - 
      198.68948040176224*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      6.870145626360221*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
      204.33087229279187*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      8.245754164161143*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      51.93593641102414*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      3.6057905963715084*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      7.807520451821723*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      6.092576621310979*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) + 
      0.004827463729124529*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      12.37160746835746*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
      12.037621425333379*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) - 
      0.5909100325272112*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) + 
   (0. - 85.46413334605849*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) + 
      127.50402464328107*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
      29.86677921929515*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      430.26634043965475*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) - 
      8.245754164161118*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) + 
      957.9405368182182*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      10.168792983499497*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) - 
      835.0075357568627*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      459.17670654164715*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      7.117160095555185*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      4.549409661156081*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      205.7717167882572*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
      18.427684574615753*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) - 
      2.2757718929713517*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) + 
   (0. - 14.163769295743728*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      3.0003561407790937*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
      41.63864760540112*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      5.010041297149728*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) - 
      51.93593641102413*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      10.168792983499486*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) + 
      48.27788252578777*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      4.699054132991431*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      4.2120587926539566*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) - 
      12.527374614232398*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) + 
      2.7985425773182433*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      9.305160107861711*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
      3.109706037872988*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) - 
      0.45858177401182737*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
   (0. + 24.99887956920109*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      46.34166750215157*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) - 
      17.124658248563666*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) + 
      203.3344238541615*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
      3.6057905963714054*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      835.007535756862*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) + 
      4.699054132991452*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      1495.5577898628208*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) - 
      1168.1044037529928*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) - 
      4.420487274386416*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) + 
      2.0508546732354844*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) + 
      450.18590142431896*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) - 
      137.30729494289866*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
      0.8749957253365914*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
   (0. - 12.316030444119395*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) + 
      26.825804209114175*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) - 
      18.19580979101105*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      124.08072290696427*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
      7.807520451821792*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) + 
      459.17670654164635*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) + 
      4.212058792653938*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) - 
      1168.1044037529923*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      1497.725564959376*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      1.5322076022099451*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      2.126198538317091*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      848.4310656820564*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
      210.5737314174035*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
      1.0471754234480475*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
   (0. + 4.843523877884227*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) + 
      6.359043933033929*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) - 
      11.596016650575809*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      7.2823431040914866*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
      6.092576621310987*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) + 
      7.117160095555183*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      12.5273746142324*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) - 
      4.420487274386414*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      1.5322076022099393*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      15.049203678396957*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      7.648826572436727*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) + 
      5.3661938315482995*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
      10.121097239132958*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
      1.5587794982526517*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) + 
   (0. - 2.1343320351244275*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      6.331475439246685*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) - 
      0.3163410294978615*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) + 
      2.493671083119994*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
      0.004827463729122756*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      4.549409661156082*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) + 
      2.798542577318243*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      2.0508546732354875*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) - 
      2.1261985383170945*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) - 
      7.648826572436724*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) + 
      9.637783868075505*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      4.313802730519434*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) - 
      5.381802995050587*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) - 
      1.0444491701348237*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) + 
   (0. - 35.70888272867214*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      43.08894767098015*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
      55.95003453917643*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) + 
      12.335029000560858*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) - 
      12.371607468357453*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      205.77171678825658*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      9.305160107861706*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      450.1859014243181*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) - 
      848.431065682056*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      5.366193831548298*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      4.313802730519439*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) + 
      1417.8526571659386*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) - 
      430.5262568070719*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
      12.11592501192607*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
   (0. - 19.10645640453046*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      45.8094800411047*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
      14.355906198671983*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) - 
      4.66475220683334*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) + 
      12.037621425333388*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) + 
      18.427684574615444*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) + 
      3.1097060378729804*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) - 
      137.30729494289815*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      210.57373141740308*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      10.121097239132965*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      5.38180299505059*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) - 
      430.5262568070717*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) + 
      1019.7324518662573*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) - 
      28.889577670747006*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
   (0. + 10000.*(-0.010938471623536256 + 0.006121132512789681*a1 + 0.0011857335669410096*a2 + 0.0006172078610202163*a3 + 0.000056726191394403756*a4))*
    (-0.010938471623536256 + 0.006121132512789681*a1 + 0.0011857335669410096*a2 + 0.0006172078610202163*a3 + 0.000056726191394403756*a4) + 
   (0. - 8.966828390538849*(-0.19320273408101807 + 0.12879372331006214*a1 - 0.057174110500245325*a2 + 0.0013875124634961703*a3 - 0.005146021808607472*a4) - 
      7.683295149284138*(-0.3143479115329667 + 0.17030926754572573*a1 - 0.05640045462072078*a2 + 0.001426760360655792*a3 - 0.005144972520885968*a4) + 
      7.464611197384711*(-0.1708387326593248 + 0.09072781719957937*a1 - 0.05401292502201878*a2 + 0.0011815460161821295*a3 - 0.00512788484768583*a4) + 
      3.18824158614613*(-0.509517486124448 + 0.21915925721565938*a1 - 0.04992449542741171*a2 + 0.0020746270868094953*a3 - 0.005095913400180201*a4) - 
      0.5909100325272091*(-0.18053824993110246 + 0.06112539065651864*a1 - 0.048754124005242594*a2 + 0.0006307830203680304*a3 - 0.005015601096667973*a4) - 
      2.2757718929713486*(-0.5909861695032811 + 0.2669903784675516*a1 - 0.03775513067331989*a2 + 0.004096085647730652*a3 - 0.00485918633509975*a4) - 
      0.4585817740118277*(-0.06139115735281687 + 0.028914383357223555*a1 - 0.03881525847109296*a2 - 0.0004211100936313332*a3 - 0.004510183181657922*a4) + 
      0.8749957253365802*(-0.6252760839266996 + 0.3000681966596898*a1 - 0.025442187945695548*a2 + 0.006682588170370216*a3 - 0.004469613515326358*a4) + 
      1.0471754234480588*(-0.622036041637313 + 0.3221364343363673*a1 - 0.01447584764855005*a2 + 0.009256889561372668*a3 - 0.004009842093445535*a4) + 
      1.5587794982526524*(-0.37105984319587043 + 0.010151921294936049*a1 - 0.028107855829512002*a2 - 0.001090991232001347*a3 - 0.003591818185190354*a4) - 
      1.0444491701348237*(-0.3506695783984577 + 0.004209104165656538*a1 - 0.022152472185697825*a2 - 0.00119341574582061*a3 - 0.0029491747427215142*a4) + 
      12.115925011926064*(-0.6093505578422935 + 0.34570448735608617*a1 + 0.0052093001148635475*a2 + 0.014209788673209054*a3 - 0.002906348178464644*a4) - 
      28.889577670747*(-0.5315155292171763 + 0.3265703298220729*a1 + 0.026709380279130408*a2 + 0.01923623613233463*a3 - 0.0010210955915416593*a4) + 
      108.9923911802645*(-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4))*
    (-0.33365336852525873 + 0.2584648616064835*a1 + 0.03123540770398052*a2 + 0.01849941263433142*a3 + 0.0001394736091445814*a4) + 
   lambda*(TMath::Power(-1 + TMath::Max(1.,TMath::Abs((66.62496812554723 - 45.11393768085737*a1 - 15.917519368707271*a2 - 10.098956026752896*a3 - 3.634009910520777*a4)/
            (-1.189731573670486 + 0.1806060300153102*a1 - 0.07290143984451301*a2 + 0.0017670719063017247*a3 - 0.0065355373121289825*a4))/5.),2) + 
      TMath::Power(-1 + TMath::Max(1.,(7*TMath::Abs((142.76778884045834 - 91.67272360183722*a1 - 27.251827218658438*a2 - 15.212048628756207*a3 - 3.215735522544522*a4)/
               (-1.189731573670486 + 0.1806060300153102*a1 - 0.07290143984451301*a2 + 0.0017670719063017247*a3 - 0.0065355373121289825*a4)))/25.),2)*
       TMath::Power(-1 + TMath::Max(1.,(8*TMath::Abs((-41.64060507846701 + 26.321211050535858*a1 + 7.448449605442044*a2 + 4.061847516720561*a3 + 0.7712561940754856*a4)/
               (-1.189731573670486 + 0.1806060300153102*a1 - 0.07290143984451301*a2 + 0.0017670719063017247*a3 - 0.0065355373121289825*a4)))/25.),2)*
       TMath::Power(-1 + TMath::Max(1.,(6*TMath::Abs((-166.56242031386805 + 109.28484420214343*a1 + 34.79379842176818*a2 + 20.247390066882243*a3 + 5.0850247763019425*a4)/
               (-1.189731573670486 + 0.1806060300153102*a1 - 0.07290143984451301*a2 + 0.0017670719063017247*a3 - 0.0065355373121289825*a4)))/25.),2));
}

double result=0;

void minuitFunction( int &nDim, double* gout, double &result, double par[], int flg)
{
  result = chiSqFunc(lambda, par);
}

double chiSqFunc2( double *par )
{
  double lambda = par[4];
  return chiSqFunc(lambda, par );
}


ROOT::Math::Minimizer* minimum;
int NumericalMinimization(const char * minName = "Minuit2",
                          const char *algoName = "" ,
                          double lambda=0.01,
                          int randomSeed = -1)
{
   // create minimizer giving a name and a name (optionally) for the specific
   // algorithm
   // possible choices are:
   //     minName                  algoName
   // Minuit /Minuit2             Migrad, Simplex,Combined,Scan  (default is Migrad)
   //  Minuit2                     Fumili2
   //  Fumili
   //  GSLMultiMin                ConjugateFR, ConjugatePR, BFGS,
   //                              BFGS2, SteepestDescent
   //  GSLMultiFit
   //   GSLSimAn
   //   Genetic
   minimum =
      ROOT::Math::Factory::CreateMinimizer(minName, algoName);

   // set tolerance , etc...
   minimum->SetMaxFunctionCalls(1000000); // for Minuit/Minuit2
   minimum->SetMaxIterations(10000);  // for GSL
   minimum->SetTolerance(0.001);
   minimum->SetPrintLevel(1);

   // create function wrapper for minimizer
   // a IMultiGenFunction type
   ROOT::Math::Functor f(&chiSqFunc2,5);
   double tolerance = 1e-8;
   // starting point

   double variable[4] = { 2.56521, 1.14046,-17.7141,6.51573};

   minimum->SetFunction(f);

   // Set the free variables to be minimized !
   minimum->SetVariable(0,"a1",variable[0], tolerance);
   minimum->SetVariable(1,"a2",variable[1], tolerance);
   minimum->SetVariable(2,"a3",variable[2], tolerance);
   minimum->SetVariable(3,"a4",variable[3], tolerance);
   minimum->SetFixedVariable(4,"lambda",lambda );

   // do the minimization
   minimum->Minimize();

//   const double *xs = minimum->X();
//   std::cout << "Minimum: f(" << xs[0] << "," << xs[1] << "," << xs[2] <<"," << xs[3] <<"): "
//             << minimum->MinValue()  << std::endl;
//
//   // expected minimum is 0
//   if ( minimum->MinValue()  < 1.E-4  && f(xs) < 1.E-4)
//      std::cout << "Minimizer " << minName << " - " << algoName
//                << "   converged to the right minimum" << std::endl;
//   else {
//      std::cout << "Minimizer " << minName << " - " << algoName
//                << "   failed to converge !!!" << std::endl;
//      Error("NumericalMinimization","fail to converge");
//   }
//
//   for( int i = 0; i< 4; i ++ )
//   {
//     for( int j = 0; j< 4; j++ )
//     {
//
//       cout<<minimum->CovMatrix(i,j)<<"\t";
//     }
//     cout<<endl;
//
//   }

   return minimum->MinValue();
}
